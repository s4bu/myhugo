<!DOCTYPE html>
<html lang="en"><head>
	<meta charset="utf-8">
	<meta name="description" content=''>
	<meta name="keywords" content=''>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href='https://www.vishalmishra.in/css/bootstrap.min.css'>
	<title>Hacking JSON Web Token</title>
	<nav class="navbar text-center sticky-top bg-white mt-2 mb-1">
		<a href='https://www.vishalmishra.in/'><span class="btn btn-sm btn-outline-primary">Home</span></a>
		<a href='https://www.vishalmishra.in/about'><span class="btn btn-sm btn-outline-secondary">About</span></a>
		<a href='https://www.vishalmishra.in/post'><span class="btn btn-sm btn-outline-success">Blog</span></a>
		<a href='https://www.vishalmishra.in/tags'><span class="btn btn-sm btn-outline-warning">Tags</span></a>
	</nav>
</head>
<body>
      <div id="content">


	<section class="container text-monospace text-justified mt-3">
	  <h2>Hacking JSON Web Token</h2>
	  <small class="text-secondary mb-5">Posted on December 6, 2017 | 2 minute read</small>
	  <p><h2 id="attack">Attack</h2>
<p>JWT is a URL safe, stateless protocol for transferring claims. A JWT token looks something like this:
<strong><span style="background-color: #98FB98">Header</span>.<span style="background-color: 	#87CEFA">UserStateInformation</span>.<span style="background-color: #FF0000">Signature</span></strong></p>
<p>Sample:<br>
<span style="background-color: #98FB98">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.<br></span>
<span style="background-color: 	#87CEFA">eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.<br></span>
<span style="background-color: #FF0000">TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</span><br></p>
<p>The information in token are separated by dots. The first and second part can be easily converted to ascii as they are base64 encoding of plain text. That being said lets dig in to these three parts of JWT token, header contain information about the algo used to encrypt (correct term would be hash generation :P). In this case HMACSHA256 is used to generate the signature out of header+UserStateInfo+Secret.</p>
<p><strong>Sample JWT Generation</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">import</span> jwt
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> encoded <span style="color:#f92672">=</span> jwt<span style="color:#f92672">.</span>encode({<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">some</span><span style="color:#e6db74">&#39;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">payload</span><span style="color:#e6db74">&#39;</span>}, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">secret</span><span style="color:#e6db74">&#39;</span>, algorithm<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">HS256</span><span style="color:#e6db74">&#39;</span>)
<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzb21lIjoicGF5bG9hZCJ9.4twFt5NiznN84AWoo1d7KO1T_yoc0Z6XOpOVswacPZg</span><span style="color:#e6db74">&#39;</span>

<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> jwt<span style="color:#f92672">.</span>decode(encoded, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">secret</span><span style="color:#e6db74">&#39;</span>, algorithms<span style="color:#f92672">=</span>[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">HS256</span><span style="color:#e6db74">&#39;</span>])
{<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">some</span><span style="color:#e6db74">&#39;</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">payload</span><span style="color:#e6db74">&#39;</span>
</code></pre></div><p>So by now it will be clear that we are after this secret because once it is known to anyone he can generate JWT token and can hijack user sessions. The JWT token authentication system is based on verifying this claim only that the token received from the client is having correct signature as per the secret hardcoded in the backend web application. 
There are some ways by which you can set even expiration date on these token like in UserStateInformation developer can embedd the timestamp parameter and while validating the message authentication code it can set condition that token will only be fully validated if it has correct MAC and the time mentioned in data section is not day or two old. Though this will be only helpful where there is any chance of social engineering, MITM and physical access to victims system, in case token does not carry any expiry and it persist post logout.</p>
<h2 id="exploit">Exploit</h2>
<p><img src="https://www.vishalmishra.in/media/hs256Cracking.gif" alt=" Quadratic Blowup Attack GIF"></p>
<h3 id="secure-implementation">Secure Implementation</h3>
<ol>
<li>Large Large Very Large Secret (Don't forget to make it complex)</li>
<li>Expiry Logic (One mentioned in article)</li>
<li>Destroying token post login</li>
<li>Secure channel transmission (SSL/TLS)</li>
<li>Rotating secret after fixed period (Code small function)</li>
<li>Use this auth/claim token as custom header and with proper CORS implementation developer can skip CSRF protection implementation as this will be suffice to protect against that as well.</li>
</ol>
<h5 id="references"><strong>References</strong>:</h5>
<ol>
<li><a href="https://jwt.io">JWT</a></li>
<li><a href="https://github.com/lmammino/jwt-cracker">GitHub</a></li>
</ol>
</p>
	  <code>tags:<span class='badge badge-dark'><a class='text-white' href='https://www.vishalmishra.in/tags/web%20attack'>Web Attack</a></span>
	  <span class='badge badge-dark'><a class='text-white' href='https://www.vishalmishra.in/tags/nodejs'>NodeJS</a></span>
	  <span class='badge badge-dark'><a class='text-white' href='https://www.vishalmishra.in/tags/exploit'>Exploit</a></span>
	  <span class='badge badge-dark'><a class='text-white' href='https://www.vishalmishra.in/tags/brute%20force'>Brute Force</a></span>
	  <span class='badge badge-dark'><a class='text-white' href='https://www.vishalmishra.in/tags/web%20exploit'>Web Exploit</a></span>
	  
	  </code>
	  <div class="container mt-2" id="comments">
	    
		<small class="mt-1">Please mail your comments to <a href="vishal_mishra@live.com">vishal_mishra@live.com</a></small><br>
	    
	  </div>
	</section>



      </div>
  </body><footer>
  <div class="container-fluid bg-dark text-white text-monospace text-center mt-4">
    <small> | Powered by <a href="https://gohugo.io">Hugo</a></small>
  </div>
  
</footer>
</html>
